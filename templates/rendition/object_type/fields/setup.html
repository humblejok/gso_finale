{% extends "finale_base.html" %}
{% block title %}Financial Lightweight Editor - Setup{% endblock %}
{% block readyoptions %}
				$(".btn").not('#comment').tooltip();
				if (urlParams.newObjectType) {
					$("#objectType").val(urlParams.newObjectType);
				}
				checkAllSteps();
{% endblock %}
{% block headeroptions %}
	<script>
		var allItems = {{global|safe}};
		var currentRow = -1;

		function checkAllSteps() {
			var objType = $("#objectType").val();
			$("#newObjectType").val(objType);
			$("#currentItems").empty();
			$.each(allItems[objType], function(index, value) {
				if (urlParams.name==value.name) {
					$("#currentItems").append('<li class="list-group-item list-group-item-success">' + value.name + '</li>');
				} else {
					$("#currentItems").append('<li class="list-group-item">' + value.name + '</li>');
				}
			});
		}

		function addField() {
			currentRow = currentRow + 1;
			$("#fieldsTable").append('<tr><td><input type="text" class="form-control" id="fieldName_' + currentRow + '"/></td><td id="fieldTypeTd_' + currentRow + '"></td><td><button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-arrow-up"></span></button><button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-arrow-down"></span></button>&nbsp;<button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span></button></td></tr>');
			$("#fieldTypeTd_" + currentRow).load("/static/templates/field_type_select_en.html");
		}
	</script>
{% endblock %}
	</head>
	<body>
{% block content %}
		<div class="row">
			<div class="col-lg-11">
				<h1 class="">Custom objects definition</h1>
	  			<p class="lead">Define all the custom objects you may need in your application.<br/>
			</div>
		</div>
		<div class="row">
			<select class='form-control no-enter' id='objectType' name='objectType' onchange="checkAllSteps()">
				{% with value='' %}
					{% include selection_template %}
				{% endwith %}
			</select>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<button data-target="#modal_create_object" class="btn btn-default col-lg-3" type="button" data-toggle="modal" data-placement="bottom" title="Create a new object">Create</button>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="list-group col-lg-3">
				<ul id="currentItems" class="list-group">
				</ul>
			</div>
			<div id="objectFieldsDiv" class="col-lg-9">
				<button class="btn btn-default btn-sm" onclick="addField()">Add field</button>
				<div>&nbsp;</div>
				<form id="define_form" role="form" action="/object_base_save.html" method="POST">{% csrf_token %}
					<table id="fieldsTable" class="table">
					</table>
				</form>
			</div>
		</div>
		<div class="modal fade" id="modal_create_object" tabindex="-1" role="dialog" aria-labelledby="modal_create_label" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="modal_create_label">Create a new object</h4>
					</div>
					<form id="create_form" role="form" action="/object_base_edit.html" method="POST">{% csrf_token %}
						<div class="modal-body">
							<div class="form-group">
								<label for="name">Name</label>
								<input name="name" type="text" class="form-control no-enter" id="name" placeholder="Enter a name" value=""/>
							</div>
						</div>
						<input type="hidden" name="newObjectType" id="newObjectType" value=""/>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-success" role="button" data-toggle="tooltip" data-placement="bottom" title="Confirm object creation and go to edition mode">Continue</button>
						</div>
					</form>
				</div>
			</div>
		</div>
{% endblock %}