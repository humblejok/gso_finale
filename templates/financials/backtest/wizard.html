{% extends "finale_base.html" %}
{% load universe_tags %}
{% block title %}Financial Lightweight Editor - Backtest wizard{% endblock %}
{% block headeroptions %}
		<script>
			$(document).ready(function () {
				$(".btn").not('#comment').tooltip();
				$("#fromDate").datepicker({ dateFormat: "yy-mm-dd" });
				$("#toDate").datepicker({ dateFormat: "yy-mm-dd" });
				$("#organicDate").datepicker({ dateFormat: "yy-mm-dd" });
				$("#reweight").change(function(e) {
					alert(e.value);
					if (e.value) {
						$(".organic").attr("class","");
					} else {
						$(".organic").attr("class","hidden");
					}
				});
				
				$(".weight-field").keydown( function(e) {
					if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 || (e.keyCode == 65 && e.ctrlKey === true) || (e.keyCode >= 35 && e.keyCode <= 39)) {
						return;
					}
					if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
						e.preventDefault();
					}
				});
			});

		</script>
{% endblock %}
{% block content %}
			<div class="row">
				<div class="col-lg-11">
					<h1 class="">Backtest an universe</h1>
					<p class="lead">Reload or create a backtest on the given universe: {{universe.name}}<br/>
				</div>
			</div>
			<form id="backtestWizard" role="form" class="form-horizontal" action="/financials_backtest_execute.html" method="POST">{% csrf_token %}
				<div class="panel-group" id="wizard">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#wizard" href="#step-one">Definition</a>
							</h4>
						</div>
						<div id="step-one" class="panel-collapse collapse in">
							<div class="panel-body">
								<div class="form-group">
									<label for="backtestName" class="col-lg-2 control-label">Name</label>
									<div class="col-lg-4">
										<input type="text" class="form-control" id="backtestName" placeholder="Backtest name">
									</div>
									<label class="col-lg-1 control-label">or</label>
									<button class="btn btn-default col-lg-4" role="button" data-toggle="tooltip" data-placement="bottom" title="Select and load an existing backtest setup" onclick"">Load</button>
								</div>
								<div class="form-group">
									<label for="fromDate" class="col-lg-2 control-label">From</label>
									<div class="col-lg-4">
										<input type="text" class="form-control" id="fromDate" name="fromDate" placeholder="Start date">
									</div>
									<label for="toDate" class="col-lg-1 control-label">to</label>
									<div class="col-lg-4">
										<input type="text" class="form-control" id="toDate" name="toDate" placeholder="End date, it can be empty!">
									</div>
								</div>
								<div class="form-group">
									<label for="frequency" class="col-lg-2 control-label">Frequency</label>
									<div class="col-lg-4">
										<select class='form-control' id='frequency' name='type'>
											{% with value="FREQ_MONTHLY" %}
												{% include 'statics/frequency_en.html' %}
											{% endwith %}
										</select>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#wizard" href="#step-two">Set securities weights</a>
							</h4>
						</div>
						<div id="step-two" class="panel-collapse collapse">
							<div class="panel-body">
								<div class="form-group">
									<label for="reweight" class="col-lg-2 control-label">Reweight policy</label>
									<div class="checkbox col-lg-3">
										<input id="reweight" name="reweight" type="checkbox" value="True">&nbsp;Reweight on frequency period
									</div>
									<label for="organicDate" class="col-lg-3 control-label organic">Allow organic growth as of</label>
									<div class="col-lg-2">
										<input type="text" class="form-control organic" id="organicDate" name="organicDate" placeholder="Date">
									</div>
								</div>
							</div>
							{% include 'rendition/wizard_backtest_form_weights.html' %}
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#wizard" href="#step-three">Define your computation rules</a>
							</h4>
						</div>
						<div id="step-three" class="panel-collapse collapse">
							<div class="panel-body">
								<div class="form-group">
									<label for="hedgingMethod" class="col-lg-2 control-label">Hedging method</label>
									<div class="col-lg-4">
										<select class='form-control' id='hedgingMethod' name='hedgingMethod'>
											<option>None</option>
										</select>
									</div>
									<label for="feesScheme" class="col-lg-2 control-label">Fees scheme</label>
									<div class="col-lg-4">
										<select class='form-control' id='feesScheme' name='feesScheme'>
											<option>None</option>
										</select>
									</div>
								</div>
								<div class="form-group">
									<label for="leverage" class="col-lg-2 control-label">Leverage</label>
									<div class="col-lg-4">
										<select class='form-control' id='leverage' name='leverage'>
											<option>None</option>
										</select>
									</div>
									<label for="historyScheme" class="col-lg-2 control-label">History completion</label>
									<div class="col-lg-4">
										<select class='form-control' id='historyScheme' name='historyScheme'>
											<option>None</option>
										</select>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<button type="submit" class="btn btn-success col-lg-12" role="button" data-toggle="tooltip" data-placement="bottom" title="Launch the computation with selected parameters">Compute</button>
				</div>
			</form>
{% endblock %}