'''
Created on Oct 16, 2014

@author: sdejonckheere
'''
from openpyxl.styles import Style
from openpyxl.styles.fonts import Font
from openpyxl.styles.borders import Border, Side, BORDER_THIN
from openpyxl.styles.alignment import Alignment
from openpyxl.styles.fills import Fill, FILL_SOLID, PatternFill
from openpyxl.styles.colors import Color
from openpyxl.styles.numbers import NumberFormat

SEQUOIA_STYLES = { 'SWM': {'bold': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(vertical='top',
                                                                    wrap_text=True)
                                                ),
                           'main_format': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                           'main_format_normal': Style(font=Font(name='Arial', bold=False, color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                           'main_format_amount': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center'),
                                                number_format='#,##0.-'
                                                ),
                           'main_format_percent': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center'),
                                                number_format='0.00%'
                                                ),
                           'green_format_percent': Style(font=Font(name='Arial', bold=True, color=Color('006100')),
                                                fill=PatternFill(fill_type=FILL_SOLID,start_color=Color('C6EFD0')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center'),
                                                number_format='0.00%'
                                                ),
                          'main_format_borderless': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                alignment=Alignment(horizontal='left',
                                                                    vertical='center')
                                                ),
                          'note_format_borderless': Style(font=Font(name='Arial', bold=True, color=Color('4F6228'), size=9),
                                                alignment=Alignment(horizontal='left',
                                                                    vertical='center')
                                                ),
                          'title_format': Style(font=Font(name='Arial', bold=True, color=Color('4F6228'), size=16, underline='single'),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                          'wrapped_format': Style(font=Font(name='Arial', bold=True, color=Color('4F6228'), underline='single'),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='top',
                                                                    wrap_text=True)
                                                ),
                           'header_format': Style(font=Font(name='Arial', bold=True, color=Color('4F6228')),
                                                fill=PatternFill(fill_type='solid',start_color=Color('C4D79B')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                           'ar_format': Style(font=Font(name='Arial', bold=True, color=Color('FFFFFF')),
                                                fill=PatternFill(fill_type='solid',start_color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                           'ar_format_percent': Style(font=Font(name='Arial', bold=True, color=Color('FFFFFF')),
                                                fill=PatternFill(fill_type='solid',start_color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center'),
                                                number_format='0.00%'
                                                ),
                           'ar_value_format': Style(font=Font(name='Arial', bold=False, color=Color('000000')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center'),
                                                number_format='0.00%'
                                                ),
                           'nta_format': Style(font=Font(name='Arial', bold=True, color=Color('FFFFFF')),
                                                fill=PatternFill(fill_type='solid',start_color=Color('4F6228')),
                                                border=Border(left=Side(border_style=BORDER_THIN),
                                                              right=Side(border_style=BORDER_THIN),
                                                              top=Side(border_style=BORDER_THIN),
                                                              bottom=Side(border_style=BORDER_THIN)
                                                              ),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                            'cfacture_format': Style(font=Font(name='Arial', bold=True, color=Color('FFFFFF')),
                                                fill=PatternFill(fill_type='solid',start_color=Color('4F6228')),
                                                alignment=Alignment(horizontal='center',
                                                                    vertical='center')
                                                ),
                           },
                   'SAM': {}
                  }

ROLE_MAPS_TEMPLATE = {'SWM':[
                            {1:{'text':"ROLE MAP (Addendum to the Mandate)", 'format':'title_format', 'merge':{'start':1,'end':7}}},
                            None,
                            {1:{'text':"Client's code", 'format':'main_format'}, 2:{'value':"container.name", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Jurisdiction", 'format':'main_format'}, 2:{'value':"get_name_from_identifier(data_map['jurisdiction'])", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Promoter", 'format':'main_format'}, 2:{'value':"get_name_from_identifier(data_map['promoter'])", 'default':'N/A', 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Strategy", 'format':'main_format'}, 2:{'value':"get_name_from_identifier(data_map['risk_profile']) + ', ' + get_name_from_identifier(data_map['strategy_profile'])", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Bank Deposit", 'format':'main_format'}, 2:{'value':"data_map['bank']", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Currency", 'format':'main_format'}, 2:{'value':"data_map['currency']", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Amount", 'format':'main_format'}, 2:{'value':"data_map['amount'] if data_map.has_key('amount') else 'Unknown'", 'format':'main_format_amount','merge':{'start':2,'end':7}}},
                            {1:{'text':"Inception date", 'format':'main_format'}, 2:{'value':"data_map['inception_date'][0:10]", 'format':'main_format','merge':{'start':2,'end':7}}},
                            None,
                            {1:{'text':["bold","Net Attributable Turnover (NAT) = GROSS TURNOVER ", "normal", "(Management Fees (MF) and/or Performance Fees (PF) and/or Commissions (OTHER) related to the current business presented and/or managed and/or shared with one or several other brokers and/or SEQUOIA' s employees, to the extent that these fees and/or commissions have been accepted, accounted for and effectively received by SEQUOIA and are not claimed by any third party),", "bold", " MINUS ", "normal", "60 basis point (60bp) or 30% of Gross Turnover (the highest applicable) calculated on current client's Asset Under Management (AUM) in order to compensate SEQUOIA for its services, licences and expenses,", "bold", " MINUS ", "normal", "all fees payable to external introducing brokers and all taxes related to the turnover generated in respect to each client account, including but not limited to professional taxes ( e.g. taxe professionnelle) irrespective of whether this has been paid in advance or not.", "wrapped_format"], 'format':'wrapped_format', 'merge':{'start':1,'end':7,'row_span':3}}},
                            None,
                            None,
                            None,
                            None,
                            {1:{'text':"External payout", 'format':'header_format'}, 2:{'text':'% of NT', 'format':'ar_value_format'}, 9:{'text':'% of GT', 'format':'cfacture_format'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'MF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B18', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B19', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_0_MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B20', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B18:B20)', 'format':'ar_format_percent'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'PF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B22', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B23', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_1_PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B24', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B22:B24)', 'format':'ar_format_percent'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'OTHER', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B26', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B27', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_TOP_AR', 'SEQUOIA_FEES_2_OF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B28', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B26:B28)', 'format':'ar_format_percent'}, 9:{'formula':'=0.7 * (1 - $B$21)', 'format':'ar_format_percent'}, 9:{'text':'NAT MF', 'format':'ar_format'}},
                            {9:{'formula':'=0.7 * (1 - $B$25)', 'format':'ar_format_percent'}, 9:{'text':'NAT PF', 'format':'ar_format'}},
                            {1:{'text':"Internal payout", 'format':'header_format'}, 2:{'text':'% of NAT', 'format':'nta_format'}, 9:{'formula':'=0.7 * (1 - $B$29)', 'format':'ar_format_percent'},9:{'text':'NAT OTHER', 'format':'ar_format'}},
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 0)",'field':'bud', 'default':'', 'format':'main_format'},  7:{'text':'MF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B32*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B33*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_0_MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B34*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B35*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B36*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_0_MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B37*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B38*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B39*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_0_MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B40*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B41*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B42*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_0_MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B43*(0.7*(1-$B$21))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B32:B43)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I32:I43)', 'format':'main_format_percent'}},
                            None,
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'PF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B46*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B47*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_1_PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B48*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B49*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B50*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_1_PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B51*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B52*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B53*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_1_PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B54*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B55*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B56*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_1_PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B57*(0.7*(1-$B$25))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B46:B57)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I46:I57)', 'format':'main_format_percent'}},
                            None,
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 0)",'field':'bud', 'default':'', 'format':'main_format'},  7:{'text':'OTHER', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B60*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B61*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_IB', 'SEQUOIA_FEES_2_OF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B62*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B63*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B64*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"gget_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_RM', 'SEQUOIA_FEES_2_OF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B65*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B66*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"gget_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B67*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_MM', 'SEQUOIA_FEES_2_OF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B68*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"gget_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B69*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B70*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map,'SEQUOIA_CHARGE_LOW_PM', 'SEQUOIA_FEES_2_OF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B71*(0.7*(1-$B$29))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B60:B71)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I60:I71)', 'format':'main_format_percent'}},
                            None,
                            None,
                            {1:{'text':'Date', 'format':'main_format_borderless'},3:{'text':'______________________________________', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) IB', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) RM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) MM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) PM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) Manager(s)', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {6:{'text': "sdj", 'format':'note_format_borderless'}, 7:{'value': "str(query_date)", 'format':'note_format_borderless'}},
                             ],                      
                      'SAM':[
                            {1:{'text':"ROLE MAP (Addendum to the Contract)", 'format':'title_format', 'merge':{'start':1,'end':7}}},
                            None,
                            {1:{'text':"Client's code", 'format':'main_format'}, 2:{'value':"data_map.client", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Client's name", 'format':'main_format'}, 2:{'value':"data_map['portfolio'].portfolio_name", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Jurisdiction", 'format':'main_format'}, 2:{'value':"data_map.jurisdiction", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Promoter", 'format':'main_format'}, 2:{'value':"get_IB_names(data_map['sub_entry'].promoter)", 'default':'Unknown', 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Nominee(s)", 'format':'main_format'}, 2:{'value':"data_map['investor_details']['invested_nominees'] if get_overriding_nominees(data_map['portfolio'], data_map.client, data_map['sub_entry'].promoter, data_map['security_id']) is None else get_overriding_nominees(data_map['portfolio'], data_map.client, data_map['sub_entry'].promoter, data_map['security_id'])", 'format':'wrapped_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Strategy", 'format':'main_format'}, 2:{'value':"data_map.strategy", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Inception Date", 'format':'main_format'}, 2:{'value':"data_map.inception_date.strftime('%b-%y')", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Bank Deposit", 'format':'main_format'}, 2:{'value':"data_map.custodian", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Currency", 'format':'main_format'}, 2:{'value':"data_map.currency", 'format':'main_format','merge':{'start':2,'end':7}}},
                            {1:{'text':"Invested amount", 'format':'main_format'}, 2:{'value':"data_map['investor_details']['invested_amount']", 'format':'main_format_amount','merge':{'start':2,'end':7}}},
                            {1:{'text':"Subscription date", 'format':'main_format'}, 2:{'value':"data_map['investor_details']['invested_date'].strftime('%m/%d/%Y')", 'format':'main_format','merge':{'start':2,'end':7}}},
                            None,
                            {1:{'text':["bold","Net Attributable Turnover (NAT) = GROSS TURNOVER ", "normal", "(Management Fees (MF) and/or Performance Fees (PF) and/or Commissions (OTHER) related to the current business presented and/or managed and/or shared with one or several other brokers and/or SEQUOIA' s employees, to the extent that these fees and/or commissions have been accepted, accounted for and effectively received by SEQUOIA and are not claimed by any third party),", "bold", " MINUS ", "normal", "60 basis point (60bp) or 30% of Gross Turnover (the highest applicable) calculated on current client's Asset Under Management (AUM) in order to compensate SEQUOIA for its services, licences and expenses,", "bold", " MINUS ", "normal", "all fees payable to external introducing brokers and all taxes related to the turnover generated in respect to each client account, including but not limited to professional taxes ( e.g. taxe professionnelle) irrespective of whether this has been paid in advance or not.", "wrapped_format"], 'format':'wrapped_format', 'merge':{'start':1,'end':7,'row_span':3}}},
                            None,
                            None,
                            None,
                            None,
                            {1:{'text':"External payout", 'format':'header_format'}, 2:{'text':'% of NT', 'format':'ar_value_format'}, 9:{'text':'% of GT', 'format':'cfacture_format'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'MF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B21', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B22', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B23', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B21:B23)', 'format':'ar_format_percent'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'PF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B25', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B26', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B27', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B25:B27)', 'format':'ar_format_percent'}},
                            {1:{'text':"Advisor & Research", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 0)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'OTHER', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':2}}, 9:{'formula':'=0.7 * B29', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 2", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 1)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B30', 'format':'main_format_percent'}},
                            {1:{'text':"Advisor & Research 3", 'format':'ar_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 2)",'field':'rate','default':0, 'format':'ar_value_format', 'on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'AR', 'Other', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=0.7 * B31', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B29:B31)', 'format':'ar_format_percent'}, 9:{'formula':'=0.7 * (1 - $B$24)', 'format':'ar_format_percent'}, 9:{'text':'NAT MF', 'format':'ar_format'}},
                            {9:{'formula':'=0.7 * (1 - $B$28)', 'format':'ar_format_percent'}, 9:{'text':'NAT PF', 'format':'ar_format'}},
                            {1:{'text':"Internal payout", 'format':'header_format'}, 2:{'text':'% of NAT', 'format':'nta_format'}, 9:{'formula':'=0.7 * (1 - $B$32)', 'format':'ar_format_percent'}, 9:{'text':'NAT OTHER', 'format':'ar_format'}},
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 0)",'field':'bud', 'default':'', 'format':'main_format'},  7:{'text':'MF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B35*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B36*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B37*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B38*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B39*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B40*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B41*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B42*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B43*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B44*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B45*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'MF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B46*(0.7*(1-$B$24))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B35:B46)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I35:I46)', 'format':'main_format_percent'}},
                            None,
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 7:{'text':'PF', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B49*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B50*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B51*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B52*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B53*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B54*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B55*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B56*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B57*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B58*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B59*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'PF', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B60*(0.7*(1-$B$28))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B49:B60)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I49:I60)', 'format':'main_format_percent'}},
                            None,
                            {1:{'text':"IB - Introducing Broker", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 0)",'field':'bud', 'default':'', 'format':'main_format'},  7:{'text':'OTHER', 'format':'cfacture_format', 'merge':{'start':7,'end':7,'row_span':12}}, 9:{'formula':'=B63*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B64*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"IB - Introducing Broker 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'IB', 'Other', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B65*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B66*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B67*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"RM - Relationship Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'RM', 'Other', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B68*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B69*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B70*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"MM - Mentor Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'MM', 'Other', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B71*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 0)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': False}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 0)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B72*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 2", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 1)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 1)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B73*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {1:{'text':"PM - Portfolio Manager 3", 'format':'main_format'}, 2:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 2)",'field':'rate','default':0, 'format':'main_format_percent','on_default_hide': True}, 3:{'value':"get_details(data_map.id, data_map['sub_entry'].promoter, 'PM', 'Other', 2)",'field':'bud', 'default':'', 'format':'main_format'}, 9:{'formula':'=B74*(0.7*(1-$B$32))', 'format':'main_format_percent'}},
                            {2:{'formula':'=SUM(B63:B74)', 'format':'main_format_percent'}, 9:{'formula':'=SUM(I63:I74)', 'format':'main_format_percent'}},
                            None,
                            None,
                            {1:{'text':'Date', 'format':'main_format_borderless'},3:{'text':'______________________________________', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) IB', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) RM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) MM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) PM', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {1:{'text':'Visa(s) Manager(s)', 'format':'main_format_borderless'},3:{'text':': .....................................................................................................................................................', 'format':'main_format_borderless'}},
                            None,
                            {6:{'text': "sdj", 'format':'note_format_borderless'}, 7:{'value': "str(query_date)", 'format':'note_format_borderless'}},
                            ]
                      }